<%- include('../includes/head.ejs') %>
  <%- include('../includes/navigation.ejs') %>
  <% if(nestedData) { %>
    <%- include('../shared/store_nested_navigation', { store: store, nestedData: nestedData }) %>
  <% } %>
  <main>
    <form class="product-form" action="/admin/<% if (editing) { %>update-user<% } else { %>add-user<% } %>" 
      method="POST">
      <div class="mb-3">
        <label for="role" class="form-label">Role</label>
        <% if(currentUser.role == 1 && store) { %>
          <div class="form-control">Admin</div>
          <input type="hidden" value="2" name="role">
        <% } else { %>
          <select id="userRole" class="form-select" name="role" aria-label="Default select example">
            <option value="">Please select a role</option>
            <% for (let roleOption of roleOptions) { %>
              <% if (editing) { %>
                <option value="<%= roleOption[1] %>" <% if ( user.role == roleOption[1]) { %>selected="selected"<% } else { %>''<% } %> ><%= roleOption[0] %></option>
              <% } else { %>  
                <option value="<%= roleOption[1] %>"><%= roleOption[0] %></option>
              <% } %>
            <% } %>
          </select>
        <% } %>  
      </div> 

      <div class="mb-3" id="selectStore" style="display: <% if (editing && user.role == 1) { %>none<% } else { %><% } %>;">
        <% if(currentUser.role == 1 && !store) { %>
          <label for="role" class="form-label">Store</label>
          <select class="form-select" name="store" aria-label="Default select example">
            <option value="">Please select a store</option>
            <% for (let store of stores) { %>
              <% if (editing) { %>
                <option value="<%= store._id %>" <% if ( user.store && user.store._id.toString() == store._id) { %>selected="selected"<% } else { %>''<% } %> ><%= store.name %></option>
              <% } else { %>  
                <option value="<%= store._id %>"><%= store.name %></option>
              <% } %>
            <% } %>
          </select>
        <% } else { %>
          <input type="hidden" value="<%= currentUser.store %>" name="store">
        <% } %>  
      </div>

      <div class="mb-3">
        <label for="first_name" class="form-label">First Name</label>
        <input type="text" name="first_name" id="first_name" class="form-control" value="<% if (editing) { %><%= user.first_name %><% } %>">
      </div>

      <div class="mb-3">
        <label for="last_name" class="form-label">Last Name</label>
        <input type="text" name="last_name" id="last_name" class="form-control" value="<% if (editing) { %><%= user.last_name %><% } %>">
      </div>

      <div class="mb-3">
        <label for="email">Email</label>
        <input type="text" name="email" class="form-control" id="email" value="<% if (editing) { %><%= user.email %><% } %>">
      </div>

      <div class="mb-3" id="passwordFields">
        <label for="password" class="form-label">Password</label>
        <input type="text" name="password" class="form-control" id="password" >
      </div>

      <div id="storeAssociateFields" style="display: <% if (editing && user.role == 3) { %><% } else { %>none<% } %>;">
        <div class="mb-3">
          <label for="username">Username</label>
          <input type="text" name="username" class="form-control" id="username" value="<% if (editing) { %><%= user.username %><% } %>">
        </div>

        <div class="mb-3">
          <label for="login_pin" class="form-label">Login Pin</label>
          <input type="number" name="login_pin" maxlength=4 class="form-control" id="login_pin" >
        </div>
      </div>
     
      <% if (editing) { %>
        <input type="hidden" value="<%= user._id %>" name="user_id">
      <% } %>

      <button class="btn btn-primary" type="submit"><% if (editing) { %>Update User<% } else { %>Add User<% } %></button>
    </form>
  </main>
  
  <!-- This is custom js file to run js in the client side -->
  <script src="/js/user.js"></script>

<%- include('../includes/end.ejs') %>
